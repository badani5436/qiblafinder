<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Qibla Finder</title>
  <link rel="manifest" href="manifest.json" />
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js");
    }

    function dmsToDecimal(degrees, minutes, seconds, direction) {
      let decimal = parseFloat(degrees) + parseFloat(minutes) / 60 + parseFloat(seconds) / 3600;
      if (direction === "S" || direction === "W") decimal *= -1;
      return decimal;
    }

    function getQiblaDirection(lat, lon) {
      const kaabaLat = 21.4225;
      const kaabaLon = 39.8262;

      const phi1 = lat * Math.PI / 180;
      const phi2 = kaabaLat * Math.PI / 180;
      const deltaLambda = (kaabaLon - lon) * Math.PI / 180;

      const y = Math.sin(deltaLambda) * Math.cos(phi2);
      const x = Math.cos(phi1) * Math.sin(phi2) -
                Math.sin(phi1) * Math.cos(phi2) * Math.cos(deltaLambda);
      let theta = Math.atan2(y, x);
      let bearing = (theta * 180 / Math.PI + 360) % 360;

      document.getElementById("result").innerText =
        `Qibla direction: ${bearing.toFixed(2)}° from true North.`;
    }

    function handleSubmit() {
      const inputType = document.querySelector('input[name="format"]:checked').value;
      if (inputType === "decimal") {
        const lat = parseFloat(document.getElementById("dec-lat").value);
        const lon = parseFloat(document.getElementById("dec-lon").value);
        getQiblaDirection(lat, lon);
      } else {
        const dLat = dmsToDecimal(
          document.getElementById("dms-lat-deg").value,
          document.getElementById("dms-lat-min").value,
          document.getElementById("dms-lat-sec").value,
          document.getElementById("dms-lat-dir").value
        );
        const dLon = dmsToDecimal(
          document.getElementById("dms-lon-deg").value,
          document.getElementById("dms-lon-min").value,
          document.getElementById("dms-lon-sec").value,
          document.getElementById("dms-lon-dir").value
        );
        getQiblaDirection(dLat, dLon);
      }
    }

    function toggleForms() {
      const type = document.querySelector('input[name="format"]:checked').value;
      document.getElementById("decimal-form").style.display = type === "decimal" ? "block" : "none";
      document.getElementById("dms-form").style.display = type === "dms" ? "block" : "none";
      document.getElementById("result").innerText = "";
    }
  </script>
</head>
<body onload="toggleForms()">
  <h2>Qibla Finder</h2>
  <label><input type="radio" name="format" value="decimal" checked onchange="toggleForms()"> Decimal Degrees</label>
  <label><input type="radio" name="format" value="dms" onchange="toggleForms()"> Degrees, Minutes, Seconds</label>

  <div id="decimal-form">
    <p><input id="dec-lat" placeholder="Latitude (e.g., 25.1)" /></p>
    <p><input id="dec-lon" placeholder="Longitude (e.g., -77.34)" /></p>
  </div>

  <div id="dms-form" style="display: none;">
    <p>Latitude: <input id="dms-lat-deg" size="3" />° <input id="dms-lat-min" size="3" />′ <input id="dms-lat-sec" size="3" />″
      <select id="dms-lat-dir"><option>N</option><option>S</option></select></p>
    <p>Longitude: <input id="dms-lon-deg" size="3" />° <input id="dms-lon-min" size="3" />′ <input id="dms-lon-sec" size="3" />″
      <select id="dms-lon-dir"><option>E</option><option>W</option></select></p>
  </div>

  <button onclick="handleSubmit()">Calculate Qibla</button>
  <p id="result"></p>
</body>
</html>
