
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="manifest" href="manifest.json" />
  <title>Qibla Finder</title>
  <style>
    body { font-family: sans-serif; padding: 1em; background: #f4f4f4; }
    h1 { text-align: center; }
    label, select, input, button { display: block; margin: 0.5em 0; width: 100%; max-width: 400px; }
    .container { max-width: 400px; margin: auto; background: white; padding: 1em; border-radius: 10px; }
  </style>

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f8f9fa;
      font-size: 1.5em;
    }
    label, button {
      display: block;
      margin-top: 20px;
      font-size: 1.2em;
    }
    input {
      font-size: 1.2em;
      padding: 5px;
    }
    .output {
      margin-top: 20px;
      font-weight: bold;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>Qibla Finder</h1>

    <button onclick="getLocation()">üìç Use Current Location</button>

    <label for="inputType">Select Input Format:</label>
    <select id="inputType" onchange="switchInput()">
      <option value="decimal">Decimal Degrees</option>
      <option value="dms">Degrees, Minutes, Seconds</option>
    </select>

    <div id="decimalInput">
      <label>Latitude (¬∞): <input type="number" step="any" id="latDec" /></label>
      <label>Longitude (¬∞): <input type="number" step="any" id="lonDec" /></label>
    </div>

    <div id="dmsInput" style="display: none;">
      <label>Latitude: 
        <input type="number" id="latDeg" placeholder="Degrees" />¬∞
        <input type="number" id="latMin" placeholder="Minutes" />'
        <input type="number" step="any" id="latSec" placeholder="Seconds" />"
      </label>
      <label>Longitude: 
        <input type="number" id="lonDeg" placeholder="Degrees" />¬∞
        <input type="number" id="lonMin" placeholder="Minutes" />'
        <input type="number" step="any" id="lonSec" placeholder="Seconds" />"
      </label>
    </div>

    <button onclick="calculateQibla()">Find Qibla Direction</button>
    <h3 id="result"></h3>
  </div>

  <script>
    function switchInput() {
      const type = document.getElementById("inputType").value;
      document.getElementById("decimalInput").style.display = type === "decimal" ? "block" : "none";
      document.getElementById("dmsInput").style.display = type === "dms" ? "block" : "none";
    }

    function convertDMSToDecimal(deg, min, sec) {
      return parseFloat(deg) + parseFloat(min) / 60 + parseFloat(sec) / 3600;
    }

    function calculateQibla() {
      const inputType = document.getElementById("inputType").value;
      let lat, lon;

      if (inputType === "decimal") {
        lat = parseFloat(document.getElementById("latDec").value);
        lon = parseFloat(document.getElementById("lonDec").value);
      } else {
        lat = convertDMSToDecimal(
          document.getElementById("latDeg").value,
          document.getElementById("latMin").value,
          document.getElementById("latSec").value
        );
        lon = convertDMSToDecimal(
          document.getElementById("lonDeg").value,
          document.getElementById("lonMin").value,
          document.getElementById("lonSec").value
        );
      }

      const kaabaLat = 21.4225 * Math.PI / 180;
      const kaabaLon = 39.8262 * Math.PI / 180;
      const userLat = lat * Math.PI / 180;
      const userLon = lon * Math.PI / 180;
      const deltaLon = kaabaLon - userLon;

      const x = Math.sin(deltaLon);
      const y = Math.cos(userLat) * Math.tan(kaabaLat) - Math.sin(userLat) * Math.cos(deltaLon);
      let qibla = Math.atan2(x, y) * 180 / Math.PI;
      if (qibla < 0) qibla += 360;

      document.getElementById("result").innerText = `Qibla Direction: ${qibla.toFixed(2)}¬∞ from North`;
    }

    function getLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
          document.getElementById("latDec").value = position.coords.latitude.toFixed(6);
          document.getElementById("lonDec").value = position.coords.longitude.toFixed(6);
          document.getElementById("inputType").value = "decimal";
          switchInput();
        }, function(error) {
          alert("Unable to retrieve location: " + error.message);
        });
      } else {
        alert("Geolocation is not supported by this browser.");
      }
    }
  </script>

  <div class="output" id="sunInfo"></div>
  <script>
    function fetchSunriseSunset(lat, lon) {
      const url = `https://api.sunrise-sunset.org/json?lat=${lat}&lng=${lon}&formatted=0`;
      fetch(url)
        .then(res => res.json())
        .then(data => {
          if (data.status === "OK") {
            const sunrise = new Date(data.results.sunrise);
            const sunset = new Date(data.results.sunset);
            const sunDiv = document.getElementById("sunInfo");
            sunDiv.innerHTML = 
              `<div>üåÖ Sunrise: ${sunrise.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
               <div>üåá Sunset: ${sunset.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>`;
          }
        });
    }

    const oldCalc = calculateQibla;
    calculateQibla = function () {
      const result = oldCalc();
      const lat = parseFloat(document.getElementById("latitude").value);
      const lon = parseFloat(document.getElementById("longitude").value);
      fetchSunriseSunset(lat, lon);
      return result;
    };
  </script>
</body>

</html>
